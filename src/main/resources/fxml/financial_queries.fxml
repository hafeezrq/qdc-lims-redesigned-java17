<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.qdc.lims.ui.controller.FinancialQueriesController"
            prefHeight="700.0" prefWidth="1000.0" style="-fx-background-color: #f5f6fa;">

    <top>
        <HBox alignment="CENTER_LEFT" spacing="20.0" style="-fx-background-color: #8e44ad; -fx-padding: 15 20;">
            <Label text="Financial Summary &amp; P&amp;L Analysis" textFill="WHITE">
                <font>
                    <Font name="System Bold" size="20.0" />
                </font>
            </Label>
            <Region HBox.hgrow="ALWAYS" />
            <Button fx:id="closeButton" text="Close" onAction="#handleClose" styleClass="admin-close-button"/>
        </HBox>
    </top>

    <center>
        <VBox spacing="20.0">
            <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
            
            <!-- Controls -->
            <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 5; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 5);">
                <Label text="Report Period:"/>
                <DatePicker fx:id="startDatePicker"/>
                <Label text="to"/>
                <DatePicker fx:id="endDatePicker"/>
                <Button text="Generate Report" onAction="#handleGenerateReport" style="-fx-background-color: #8e44ad; -fx-text-fill: white;"/>
            </HBox>
            
            <!-- High Level Summary -->
            <HBox spacing="20">
                <VBox style="-fx-background-color: #27ae60; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 250;">
                     <Label text="Total Income" textFill="WHITE" style="-fx-font-size: 16;"/>
                     <Label fx:id="totalIncomeLabel" text="\$0.00" textFill="WHITE" style="-fx-font-size: 28; -fx-font-weight: bold;"/>
                </VBox>
                
                <VBox style="-fx-background-color: #c0392b; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 250;">
                     <Label text="Total Expenses" textFill="WHITE" style="-fx-font-size: 16;"/>
                     <Label fx:id="totalExpenseLabel" text="\$0.00" textFill="WHITE" style="-fx-font-size: 28; -fx-font-weight: bold;"/>
                </VBox>
                
                <VBox fx:id="profitCard" style="-fx-background-color: #2980b9; -fx-padding: 20; -fx-background-radius: 5; -fx-pref-width: 250;">
                     <Label text="Net Profit / Loss" textFill="WHITE" style="-fx-font-size: 16;"/>
                     <Label fx:id="netProfitLabel" text="\$0.00" textFill="WHITE" style="-fx-font-size: 28; -fx-font-weight: bold;"/>
                </VBox>
            </HBox>

            <!-- Liabilities & Receivables -->
            <HBox spacing="20">
                <VBox style="-fx-background-color: #f39c12; -fx-padding: 16; -fx-background-radius: 5; -fx-pref-width: 250;">
                     <Label text="Outstanding Patient Balances" textFill="WHITE" style="-fx-font-size: 14;"/>
                     <Label fx:id="patientReceivableLabel" text="\$0.00" textFill="WHITE" style="-fx-font-size: 22; -fx-font-weight: bold;"/>
                </VBox>
                <VBox style="-fx-background-color: #d35400; -fx-padding: 16; -fx-background-radius: 5; -fx-pref-width: 250;">
                     <Label text="Unpaid Doctor Commissions" textFill="WHITE" style="-fx-font-size: 14;"/>
                     <Label fx:id="unpaidCommissionLabel" text="\$0.00" textFill="WHITE" style="-fx-font-size: 22; -fx-font-weight: bold;"/>
                </VBox>
                <VBox style="-fx-background-color: #7f8c8d; -fx-padding: 16; -fx-background-radius: 5; -fx-pref-width: 250;">
                     <Label text="Supplier Payables" textFill="WHITE" style="-fx-font-size: 14;"/>
                     <Label fx:id="supplierPayableLabel" text="\$0.00" textFill="WHITE" style="-fx-font-size: 22; -fx-font-weight: bold;"/>
                </VBox>
            </HBox>

            <!-- Breakdown -->
            <SplitPane dividerPositions="0.6" VBox.vgrow="ALWAYS">
                <items>
                    <!-- Category Table -->
                    <VBox spacing="10">
                        <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                        <Label text="Category Breakdown" style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                        <TableView fx:id="categoryTable" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="categoryNameCol" text="Category" prefWidth="200"/>
                                <TableColumn fx:id="typeCol" text="Type" prefWidth="100"/>
                                <TableColumn fx:id="countCol" text="Transactions" prefWidth="100"/>
                                <TableColumn fx:id="amountCol" text="Total Amount" prefWidth="120"/>
                            </columns>
                            <columnResizePolicy>
                                <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                            </columnResizePolicy>
                        </TableView>
                    </VBox>
                    
                    <!-- Visualization (Pie Chart) -->
                    <VBox spacing="10" alignment="TOP_CENTER">
                        <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                        <Label text="Expense Distribution" style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                        <PieChart fx:id="expenseChart" legendSide="BOTTOM"/>
                    </VBox>
                </items>
            </SplitPane>
        </VBox>
    </center>

</BorderPane>
